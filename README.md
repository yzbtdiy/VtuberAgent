# VTuber API - Rust å®ç°

åŸºäº Rust å’Œ Rig AI æ¡†æ¶æ„å»ºçš„é«˜æ€§èƒ½ VTuber å¼¹å¹•å¤„ç†ç³»ç»Ÿã€‚

## ğŸš€ æœ€æ–°æ›´æ–° (v0.2.0)

### æ–°å¢åŠŸèƒ½
- **å¤šæä¾›å•†åµŒå…¥å‘é‡ç³»ç»Ÿ**: æ”¯æŒ `rust_hash`, `openai`, `dmeta-embedding-zh` ä¸‰ç§åµŒå…¥æä¾›å•†
- **çº¯ WebSocket å®ç°**: ç§»é™¤ axum ä¾èµ–ï¼Œä½¿ç”¨ tokio-tungstenite æä¾›æ›´è½»é‡çš„å®ç°
- **çµæ´»çš„ TTS é…ç½®**: æ”¯æŒ OpenAI TTS å’Œ IndexTTS ä¸¤ç§è¯­éŸ³åˆæˆæœåŠ¡
- **æ™ºèƒ½å‘é‡å­˜å‚¨**: Qdrant é›†æˆæ”¯æŒå¤šç»´åº¦å‘é‡å’Œæä¾›å•†æ ‡è®°

è¯¦ç»†æ›´æ–°å†…å®¹è¯·æŸ¥çœ‹ [EMBEDDING_PROVIDERS_UPDATE.md](EMBEDDING_PROVIDERS_UPDATE.md)

## é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ VTuber å¼¹å¹•å¤„ç†ç³»ç»Ÿçš„ Rust å®ç°ï¼Œä½¿ç”¨æœ€æ–°çš„ Rig 0.18.2 æ¡†æ¶è¿›è¡Œ AI æ“ä½œã€‚å®ƒæä¾›å®æ—¶ WebSocket é€šä¿¡ã€åŸºäºç­¾åçš„èº«ä»½éªŒè¯ã€3. **å¯åŠ¨ IndexTTS æœåŠ¡**ï¼š
   ç¡®ä¿ IndexTTS æœåŠ¡åœ¨æŒ‡å®šçš„åœ°å€è¿è¡Œã€‚

4. **æµ‹è¯• IndexTTS**ï¼š
   ä½¿ç”¨æä¾›çš„æµ‹è¯•è„šæœ¬ï¼š
   ```bash
   python test_indextts.py
   ```

## åµŒå…¥å‘é‡ (Embedding) é…ç½®

VTuber API æ”¯æŒå¤šç§åµŒå…¥å‘é‡æä¾›å•†ï¼š

### æ”¯æŒçš„åµŒå…¥æä¾›å•†

#### 1. OpenAI Embeddings
ä½¿ç”¨ OpenAI çš„ text-embedding-3-small æ¨¡å‹ç”Ÿæˆ 1536 ç»´åµŒå…¥å‘é‡ã€‚

#### 2. Dmeta Embedding ZH
æœ¬åœ°éƒ¨ç½²çš„ä¸­æ–‡åµŒå…¥æ¨¡å‹ï¼Œç”Ÿæˆ 768 ç»´åµŒå…¥å‘é‡ï¼Œç‰¹åˆ«é€‚åˆä¸­æ–‡æ–‡æœ¬å¤„ç†ã€‚

#### 3. Rust Hash (é»˜è®¤)
åŸºäºå“ˆå¸Œçš„å ä½ç¬¦æ–¹æ³•ï¼Œç”Ÿæˆ 1536 ç»´ç¡®å®šæ€§åµŒå…¥å‘é‡ï¼Œç”¨äºå¼€å‘å’Œæµ‹è¯•ã€‚

### é…ç½®åµŒå…¥æä¾›å•†

åœ¨ `config.json` ä¸­è®¾ç½® `embedding_provider`ï¼š

```json
{
  "server": {
    "embedding_provider": "openai"  // å¯é€‰: "openai", "dmeta-embedding-zh", "rust_hash"
  },
  "openai": {
    "embedding_model": "text-embedding-3-small"
  },
  "dmeta_embedding": {
    "url": "http://localhost:8000",
    "model": "dmeta-embedding-zh"
  }
}
```

### Dmeta Embedding ZH API

Dmeta Embedding ZH ä½¿ç”¨æ ‡å‡†çš„åµŒå…¥ API æ ¼å¼ï¼š

```bash
curl -X POST 'http://localhost:8000/v1/embeddings' \
  -H 'Content-Type: application/json' \
  -d '{
    "input": "æµ‹è¯•æ–‡æœ¬",
    "model": "dmeta-embedding-zh"
  }'
```

å“åº”æ ¼å¼ï¼š
```json
{
  "object": "list",
  "data": [
    {
      "object": "embedding",
      "embedding": [0.015861066058278084, ...],
      "index": 0
    }
  ],
  "model": "dmeta-embedding-zh",
  "usage": {
    "prompt_tokens": 8,
    "total_tokens": 8
  }
}
```å’Œæ–‡æœ¬è½¬è¯­éŸ³åŠŸèƒ½çš„æ™ºèƒ½å¼¹å¹•å¤„ç†ã€‚è¯¥ç³»ç»Ÿè®¾è®¡ç”¨äºä¸å„ç§ AI API ç«¯ç‚¹é…åˆå·¥ä½œï¼Œå¹¶æ”¯æŒä¸åŒ AI æä¾›å•†çš„çµæ´»é…ç½®ã€‚

## åŠŸèƒ½ç‰¹æ€§

- **çº¯ WebSocket æ¶æ„**ï¼šåŸºäº tokio-tungstenite çš„è½»é‡çº§ WebSocket æœåŠ¡å™¨ï¼Œæ— éœ€ HTTP æ¡†æ¶
- **Rig AI æ¡†æ¶ 0.18.2**ï¼šåˆ©ç”¨æœ€æ–°çš„ Rig ç‰ˆæœ¬è¿›è¡Œæ™ºèƒ½å¤šä»£ç†å¤„ç†
- **çµæ´»çš„ AI API æ”¯æŒ**ï¼šå¯é…ç½®çš„åŸºç¡€ URL æ”¯æŒå¤šç§ AI ç«¯ç‚¹
- **é•¿æœŸè®°å¿†ç³»ç»Ÿ**ï¼šåŸºäº Qdrant å‘é‡æ•°æ®åº“çš„æ™ºèƒ½è®°å¿†å’Œä¸Šä¸‹æ–‡æ£€ç´¢
- **å¼ºåˆ¶èº«ä»½éªŒè¯**ï¼šåŸºäº HMAC-SHA256 ç­¾åçš„èº«ä»½éªŒè¯
- **æ„å›¾åˆ†æ**ï¼šè‡ªåŠ¨åˆ†ç±»å¼¹å¹•å†…å®¹
- **å¤šæ¨¡æ€å“åº”**ï¼šæ–‡æœ¬ã€éŸ³é¢‘å’Œå›¾åƒç”Ÿæˆ
- **å®æ—¶è¿›åº¦æ›´æ–°**ï¼šå¤„ç†è¿‡ç¨‹ä¸­çš„å®æ—¶çŠ¶æ€æŠ¥å‘Š
- **é«˜æ€§èƒ½**ï¼šåŸºäº Rust 2024 edition æ„å»ºï¼Œä¿è¯é€Ÿåº¦å’Œå¯é æ€§
- **JSON é…ç½®ç®¡ç†**ï¼šç»“æ„åŒ–çš„ config.json é…ç½®æ–‡ä»¶ï¼Œæ”¯æŒå¤æ‚é…ç½®
- **å›¾åƒ URL å“åº”**ï¼šè¿”å›å›¾åƒ URL è€ŒéäºŒè¿›åˆ¶æ•°æ®ï¼Œæé«˜å…¼å®¹æ€§
- **æœ€å°åŒ–ä¾èµ–**ï¼šç§»é™¤äº† axumã€tower ç­‰ HTTP æ¡†æ¶ä¾èµ–ï¼Œä½¿ç”¨çº¯ WebSocket å®ç°

## ç³»ç»Ÿæ¶æ„

### æ ¸å¿ƒç»„ä»¶

1. **WebSocket æœåŠ¡å™¨** (`src/api/websocket_server.rs`)ï¼šåŸºäº tokio-tungstenite çš„çº¯ WebSocket æœåŠ¡å™¨
2. **èº«ä»½éªŒè¯æœåŠ¡** (`src/auth/mod.rs`)ï¼šHMAC-SHA256 ç­¾åéªŒè¯
3. **AI ä»£ç†** (`src/agents/mod.rs`)ï¼šåŸºäº Rig çš„æ„å›¾åˆ†æå’Œå“åº”ç”Ÿæˆ
4. **å·¥å…·é›†** (`src/tools/mod.rs`)ï¼šå›¾åƒç”Ÿæˆå’Œ TTS é›†æˆ
5. **å·¥ä½œæµå¼•æ“** (`src/workflows/mod.rs`)ï¼šç¼–æ’å®Œæ•´çš„å¤„ç†æµæ°´çº¿
6. **å®¢æˆ·ç«¯ç®¡ç†å™¨** (`src/services/mod.rs`)ï¼šç®¡ç† WebSocket è¿æ¥å’Œèº«ä»½éªŒè¯
7. **é•¿æœŸè®°å¿†ç³»ç»Ÿ** (`src/memory/mod.rs`)ï¼šåŸºäº Qdrant çš„å‘é‡å­˜å‚¨å’Œè¯­ä¹‰æœç´¢

### AI å¤„ç†æµæ°´çº¿

1. **æ„å›¾åˆ†æ**ï¼šä½¿ç”¨ Rig ä»£ç†åˆ†ç±»å¼¹å¹•æ„å›¾
2. **å“åº”ç”Ÿæˆ**ï¼šé’ˆå¯¹ä¸åŒå†…å®¹ç±»å‹çš„ä¸“é—¨ä»£ç†
3. **å›¾åƒç”Ÿæˆ**ï¼šAI é©±åŠ¨çš„ç»˜ç”»åŠŸèƒ½ç”¨äºè‰ºæœ¯è¯·æ±‚
4. **éŸ³é¢‘åˆæˆ**ï¼šæ–‡æœ¬è½¬è¯­éŸ³åŠŸèƒ½ç”¨äºè¯­éŸ³å“åº”
5. **è¿›åº¦æŠ¥å‘Š**ï¼šæ•´ä¸ªå¤„ç†è¿‡ç¨‹çš„å®æ—¶æ›´æ–°

## å¿«é€Ÿå¼€å§‹

### ç³»ç»Ÿè¦æ±‚

- Rust 1.70+ å’Œ Cargo (æ¨èä½¿ç”¨ 2024 edition)
- å…¼å®¹ OpenAI API æ ¼å¼çš„ AI API ç«¯ç‚¹
- AI æœåŠ¡çš„ API å¯†é’¥
- ï¼ˆå¯é€‰ï¼‰Qdrant å‘é‡æ•°æ®åº“ç”¨äºé•¿æœŸè®°å¿†åŠŸèƒ½
- ï¼ˆå¯é€‰ï¼‰ç”¨äºå¢å¼º RAG åŠŸèƒ½çš„å‘é‡æ•°æ®åº“

### å®‰è£…æ­¥éª¤

```bash
# å…‹éš†ä»“åº“
git clone <repository-url>
cd VtuberAPI

# æ„å»ºé¡¹ç›®
cargo build

# å¤åˆ¶é…ç½®æ–‡ä»¶
cp config.example.json config.json
# ç¼–è¾‘ config.json æ–‡ä»¶é…ç½®æ‚¨çš„ API è®¾ç½®
```

### é…ç½®è¯´æ˜

ç¼–è¾‘ `config.json` æ–‡ä»¶è¿›è¡Œé…ç½®ï¼š

```json
{
  "server": {
    "host": "localhost",
    "port": 8000,
    "tts_provider": "openai",
    "embedding_provider": "openai"
  },
  "auth": {
    "secret_key": "your_secret_key_here_change_in_production",
    "valid_api_keys": [
      "your-api-key-1",
      "your-api-key-2"
    ],
    "timestamp_tolerance": 300
  },
  "openai": {
    "api_key": "your_openai_api_key_here",
    "base_url": "https://api.openai.com/v1",
    "model": "gpt-3.5-turbo",
    "embedding_model": "text-embedding-3-small",
    "tts_model": "tts-1",
    "tts_voice": "alloy"
  },
  "indextts": {
    "url": "http://localhost:11996",
    "model": "tts-1",
    "voice": "jay_klee"
  },
  "dmeta_embedding": {
    "url": "http://localhost:8000",
    "model": "dmeta-embedding-zh"
  },
  "processing": {
    "max_danmaku_length": 100,
    "response_timeout": 30,
    "max_execution_time": 120
  },
  "long_term_memory": {
    "enabled": true,
    "qdrant": {
      "url": "http://localhost:6334",
      "collection_name": "vtuber_memory",
      "vector_size": 1536,
      "distance": "Cosine"
    },
    "context": {
      "max_context_length": 10,
      "similarity_threshold": 0.7,
      "memory_retention_days": 30
    }
  },
  "logging": {
    "rust_log": "info",
    "otel_sdk_disabled": true,
    "crewai_telemetry_disabled": true
  }
}
```

**æ³¨æ„**ï¼šæ­¤ç³»ç»Ÿä½¿ç”¨ç»“æ„åŒ–çš„ JSON é…ç½®æ–‡ä»¶è€Œéç¯å¢ƒå˜é‡ï¼Œä»¥å®ç°æ›´å¯é å’Œçµæ´»çš„é…ç½®ç®¡ç†ã€‚

## TTS (æ–‡æœ¬è½¬è¯­éŸ³) é…ç½®

VTuber API æ”¯æŒä¸¤ç§ TTS æœåŠ¡ï¼š

### OpenAI TTS
é»˜è®¤ä½¿ç”¨ OpenAI çš„æ–‡æœ¬è½¬è¯­éŸ³æœåŠ¡ï¼Œæ”¯æŒå¤šç§è¯­éŸ³æ¨¡å‹ã€‚

### IndexTTS
IndexTTS æ˜¯ä¸€ä¸ªæœ¬åœ°éƒ¨ç½²çš„ TTS æœåŠ¡ï¼Œæ”¯æŒæ›´å¤šè¯­éŸ³é€‰æ‹©å’Œæ›´å¿«çš„å“åº”é€Ÿåº¦ã€‚

#### é…ç½® IndexTTS

1. **å¯ç”¨ IndexTTS**ï¼š
   åœ¨ `config.json` ä¸­è®¾ç½®ï¼š
   ```json
   {
     "server": {
       "tts_provider": "indextts"
     },
     "indextts": {
       "url": "http://localhost:11996",
       "model": "tts-1",
       "voice": "jay_klee"
     }
   }
   ```

2. **åˆ‡æ¢å› OpenAI TTS**ï¼š
   ```json
   {
     "server": {
       "tts_provider": "openai"
     }
   }
   ```

2. **å¯åŠ¨ IndexTTS æœåŠ¡**ï¼š
   ç¡®ä¿ IndexTTS æœåŠ¡åœ¨æŒ‡å®šçš„åœ°å€è¿è¡Œã€‚

3. **æµ‹è¯• IndexTTS**ï¼š
   ä½¿ç”¨æä¾›çš„æµ‹è¯•è„šæœ¬ï¼š
   ```bash
   python test_indextts.py
   ```

#### API å‚è€ƒ

IndexTTS ä½¿ç”¨ä¸ OpenAI å…¼å®¹çš„ API æ ¼å¼ï¼š

```bash
curl -X POST 'http://localhost:11996/audio/speech' \
  -H 'Content-Type: application/json' \
  -d '{
    "model": "tts-1",
    "input": "ä½ å¥½",
    "voice": "jay_klee"
  }'
```

å“åº”ä½“ä¸ºéŸ³é¢‘æ•°æ® (MP3 æ ¼å¼)ã€‚

## é•¿æœŸè®°å¿†åŠŸèƒ½

VTuber API æ”¯æŒåŸºäº Qdrant å‘é‡æ•°æ®åº“çš„æ™ºèƒ½é•¿æœŸè®°å¿†ç³»ç»Ÿï¼Œèƒ½å¤Ÿè®°ä½ç”¨æˆ·çš„äº’åŠ¨å†å²å¹¶æä¾›ä¸Šä¸‹æ–‡ç›¸å…³çš„å“åº”ã€‚

### åŠŸèƒ½ç‰¹æ€§

- **è¯­ä¹‰æœç´¢**ï¼šåŸºäºå†…å®¹ç›¸ä¼¼æ€§æ£€ç´¢ç›¸å…³çš„å†å²äº’åŠ¨
- **ç”¨æˆ·ä¸“å±è®°å¿†**ï¼šä¸ºæ¯ä¸ªç”¨æˆ·ç»´æŠ¤ç‹¬ç«‹çš„è®°å¿†ç©ºé—´
- **æ„å›¾æ„ŸçŸ¥**ï¼šæ ¹æ®æ„å›¾ç±»å‹ç»„ç»‡å’Œæ£€ç´¢è®°å¿†
- **å¯é…ç½®é˜ˆå€¼**ï¼šæ”¯æŒè‡ªå®šä¹‰ç›¸ä¼¼æ€§é˜ˆå€¼å’Œä¸Šä¸‹æ–‡é•¿åº¦
- **è‡ªåŠ¨æ¸…ç†**ï¼šå¯é…ç½®çš„è®°å¿†ä¿ç•™æœŸé™

### é…ç½®è¯´æ˜

åœ¨ `config.json` ä¸­é…ç½®é•¿æœŸè®°å¿†ï¼š

```json
{
  "long_term_memory": {
    "enabled": true,                    // å¯ç”¨/ç¦ç”¨é•¿æœŸè®°å¿†
    "qdrant": {
      "url": "http://localhost:6334",  // Qdrant æœåŠ¡å™¨åœ°å€
      "collection_name": "vtuber_memory", // é›†åˆåç§°
      "vector_size": 1536,             // å‘é‡ç»´åº¦ï¼ˆä¸åµŒå…¥æ¨¡å‹åŒ¹é…ï¼‰
      "distance": "Cosine"             // è·ç¦»ç®—æ³•ï¼šCosine/Dot/Euclid/Manhattan
    },
    "context": {
      "max_context_length": 10,        // æœ€å¤§ä¸Šä¸‹æ–‡æ¡ç›®æ•°
      "similarity_threshold": 0.7,     // ç›¸ä¼¼æ€§é˜ˆå€¼ï¼ˆ0.0-1.0ï¼‰
      "memory_retention_days": 30      // è®°å¿†ä¿ç•™å¤©æ•°
    }
  }
}
```

### Qdrant è®¾ç½®

1. **å®‰è£… Qdrant**ï¼š
   
   **Windows**ï¼š
   ```bash
   # ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„ Qdrant Windows äºŒè¿›åˆ¶æ–‡ä»¶
   # è®¿é—®ï¼šhttps://github.com/qdrant/qdrant/releases
   # ä¸‹è½½ qdrant-x86_64-pc-windows-msvc.zip
   
   # è§£å‹å¹¶è¿è¡Œ
   qdrant.exe
   ```
   
   **Linux/macOS**ï¼š
   ```bash
   # ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶
   wget https://github.com/qdrant/qdrant/releases/latest/download/qdrant-x86_64-unknown-linux-musl.tar.gz
   tar -xzf qdrant-x86_64-unknown-linux-musl.tar.gz
   
   # è¿è¡Œ Qdrant
   ./qdrant
   ```

2. **éªŒè¯è¿æ¥**ï¼š
   ```bash
   curl http://localhost:6333/
   ```

3. **æŸ¥çœ‹é›†åˆ**ï¼š
   ```bash
   curl http://localhost:6333/collections
   ```

### å·¥ä½œåŸç†

1. **å­˜å‚¨äº’åŠ¨**ï¼šæ¯æ¬¡ç”¨æˆ·äº’åŠ¨éƒ½ä¼šè¢«è½¬æ¢ä¸ºå‘é‡å¹¶å­˜å‚¨åœ¨ Qdrant ä¸­
2. **ä¸Šä¸‹æ–‡æ£€ç´¢**ï¼šå¤„ç†æ–°è¯·æ±‚æ—¶ï¼Œç³»ç»Ÿä¼šæœç´¢ç›¸å…³çš„å†å²äº’åŠ¨
3. **æ™ºèƒ½å“åº”**ï¼šAI ä»£ç†ä¼šåŸºäºæ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡ç”Ÿæˆæ›´ä¸ªæ€§åŒ–çš„å“åº”
4. **è®°å¿†ç®¡ç†**ï¼šç³»ç»Ÿä¼šè‡ªåŠ¨æ¸…ç†è¿‡æœŸçš„è®°å¿†ä»¥ä¿æŒæ€§èƒ½

### è¿è¡Œç¨‹åº

```bash
# å¼€å‘æ¨¡å¼
cargo run

# ç”Ÿäº§æ„å»ºå’Œè¿è¡Œ
cargo build --release
./target/release/VtuberAPI

# Windows PowerShell
.\target\release\VtuberAPI.exe
```

## API å‚è€ƒ

### WebSocket ç«¯ç‚¹

- `ws://localhost:8000` - ä¸»è¦ WebSocket ç«¯ç‚¹ï¼ˆç›´æ¥è¿æ¥ï¼Œæ— éœ€è·¯å¾„ï¼‰

**æ³¨æ„**ï¼šæ­¤ç‰ˆæœ¬ç§»é™¤äº†æ‰€æœ‰ HTTP API ç«¯ç‚¹ï¼ˆ`/health`ã€`/stats` ç­‰ï¼‰ï¼Œä¸“æ³¨äºçº¯ WebSocket é€šä¿¡ã€‚å¦‚éœ€ç›‘æ§å’Œç®¡ç†åŠŸèƒ½ï¼Œå¯é€šè¿‡ WebSocket æ¶ˆæ¯å®ç°ã€‚

### æ¶ˆæ¯ç±»å‹

#### èº«ä»½éªŒè¯
```json
{
  "type": "auth",
  "auth_data": {
    "type": "signature",
    "user_id": "user123",
    "api_key": "your-api-key",
    "timestamp": "2024-01-01T00:00:00Z",
    "nonce": "random-string",
    "signature": "hmac-sha256-signature"
  }
}
```

#### å¼¹å¹•å¤„ç†
```json
{
  "type": "danmaku",
  "content": "ç”»ä¸€åªå¯çˆ±çš„å°çŒ«å’ª",
  "user_id": "user123",
  "timestamp": "2024-01-01T00:00:00Z"
}
```

#### è¿›åº¦æ›´æ–°
```json
{
  "type": "progress",
  "stage": "image_generation_start",
  "message": "ğŸ¨ æ­£åœ¨ä¸ºæ‚¨åˆ›ä½œå›¾ç‰‡ï¼Œè¯·ç¨ç­‰ç‰‡åˆ»...",
  "image_prompt": "å¯çˆ±çš„å°çŒ«å’ª"
}
```

#### å¸¦å›¾åƒ URL çš„å“åº”
```json
{
  "type": "danmaku_response",
  "content": "å·²ä¸ºæ‚¨åˆ›ä½œäº†ä¸€å¹…å¯çˆ±çš„å°çŒ«å’ªå›¾ç‰‡ï¼",
  "image_url": "https://your-api.com/generated-image-url",
  "intent": "image_generation",
  "user_id": "user123",
  "timestamp": "2024-01-01T00:00:00Z"
}
```

## å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ main.rs              # åº”ç”¨ç¨‹åºå…¥å£ç‚¹
â”œâ”€â”€ config/              # é…ç½®ç®¡ç†
â”œâ”€â”€ models/              # æ•°æ®ç»“æ„å’Œç±»å‹
â”œâ”€â”€ auth/                # èº«ä»½éªŒè¯æœåŠ¡
â”œâ”€â”€ agents/              # Rig AI ä»£ç†
â”œâ”€â”€ tools/               # å¤–éƒ¨æœåŠ¡é›†æˆ
â”œâ”€â”€ workflows/           # å¤„ç†ç¼–æ’
â”œâ”€â”€ services/            # å®¢æˆ·ç«¯å’Œè¿æ¥ç®¡ç†
â”œâ”€â”€ memory/              # é•¿æœŸè®°å¿†å’Œå‘é‡å­˜å‚¨
â””â”€â”€ api/                 # WebSocket æœåŠ¡å™¨å’Œç«¯ç‚¹
```

### æ ¸å¿ƒè®¾è®¡æ¨¡å¼

1. **Rig 0.18.1 é›†æˆ**ï¼šä½¿ç”¨æœ€æ–°çš„ Rig æ¡†æ¶è¿›è¡Œä»£ç†å’Œå®Œæˆæ¨¡å¼
2. **çµæ´»çš„ AI API æ”¯æŒ**ï¼šä¸ºä¸åŒ AI æä¾›å•†æä¾›å¯é…ç½®çš„åŸºç¡€ URL
3. **JSON é…ç½®ç®¡ç†**ï¼šç»“æ„åŒ–çš„ config.json æ–‡ä»¶ï¼Œæ”¯æŒå¤æ‚é…ç½®
4. **å¼‚æ­¥/ç­‰å¾…**ï¼šä½¿ç”¨ Tokio è¿è¡Œæ—¶çš„å®Œå…¨å¼‚æ­¥
5. **ç±»å‹å®‰å…¨**ï¼šåˆ©ç”¨ Rust çš„ç±»å‹ç³»ç»Ÿä¿è¯å¯é æ€§
6. **é”™è¯¯å¤„ç†**ï¼šä½¿ç”¨ `anyhow` è¿›è¡Œå…¨é¢çš„é”™è¯¯ä¼ æ’­
7. **æ¨¡å—åŒ–æ¶æ„**ï¼šæ¸…æ™°çš„å…³æ³¨ç‚¹åˆ†ç¦»
8. **åŸºäº URL çš„åª’ä½“**ï¼šè¿”å› URL è€ŒéäºŒè¿›åˆ¶æ•°æ®ä»¥æé«˜æ€§èƒ½

### æ·»åŠ æ–°åŠŸèƒ½

1. **æ–°æ„å›¾ç±»å‹**ï¼šæ‰©å±• `IntentType` æšä¸¾å¹¶æ·»åŠ ç›¸åº”çš„ä»£ç†
2. **é™„åŠ å·¥å…·**ï¼šåœ¨ `src/tools/` ä¸­å®ç°æ–°å·¥å…·
3. **å¢å¼ºèº«ä»½éªŒè¯**ï¼šæ‰©å±• `AuthService` ä»¥æ”¯æŒæ–°çš„è®¤è¯æ–¹æ³•
4. **å‘é‡å­˜å‚¨**ï¼šä¸º RAG åŠŸèƒ½æ·»åŠ  Rig å‘é‡å­˜å‚¨é›†æˆ

## æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cargo test

# å¸¦è¾“å‡ºè¿è¡Œ
cargo test -- --nocapture

# æ£€æŸ¥ä»£ç è´¨é‡
cargo check
cargo clippy

# æ ¼å¼åŒ–ä»£ç 
cargo fmt
```

### WebSocket æµ‹è¯•

ä½¿ç”¨åŒ…å«çš„ `websocket_test.html` æ–‡ä»¶æµ‹è¯• WebSocket è¿æ¥ï¼š

1. åœ¨ Web æµè§ˆå™¨ä¸­æ‰“å¼€ `websocket_test.html`
2. é…ç½®æ‚¨çš„èº«ä»½éªŒè¯å‡­æ®
3. æµ‹è¯•èº«ä»½éªŒè¯å’Œå¼¹å¹•å¤„ç†

## æ€§èƒ½ç‰¹ç‚¹

- **å†…å­˜é«˜æ•ˆ**ï¼šRust çš„é›¶æˆæœ¬æŠ½è±¡
- **å¹¶å‘å¤„ç†**ï¼šTokio å¼‚æ­¥è¿è¡Œæ—¶
- **è¿æ¥æ± **ï¼šé«˜æ•ˆçš„ HTTP å®¢æˆ·ç«¯é‡ç”¨
- **æµå¼å“åº”**ï¼šå®æ—¶æ•°æ®å¤„ç†

## å®‰å…¨æ€§

- **å¼ºåˆ¶èº«ä»½éªŒè¯**ï¼šä¸å…è®¸åŒ¿åè®¿é—®
- **HMAC ç­¾å**ï¼šåŠ å¯†å®‰å…¨çš„èº«ä»½éªŒè¯
- **æ—¶é—´æˆ³éªŒè¯**ï¼šé˜²æ­¢é‡æ”¾æ”»å‡»
- **è¾“å…¥éªŒè¯**ï¼šå…¨é¢çš„è¯·æ±‚éªŒè¯

## ç›‘æ§

æœåŠ¡å™¨æä¾›å†…ç½®ç›‘æ§ç«¯ç‚¹ï¼š

- `/health` å¥åº·æ£€æŸ¥
- `/stats` è¿æ¥ç»Ÿè®¡
- ä½¿ç”¨ `tracing` çš„ç»“æ„åŒ–æ—¥å¿—

## ç”Ÿäº§éƒ¨ç½²

### ç¯å¢ƒè®¾ç½®

1. ä¸ºç”Ÿäº§ç¯å¢ƒè®¾ç½®å¼º `secret_key`
2. ä¸ºæ‚¨çš„æˆæƒå®¢æˆ·ç«¯é…ç½® `valid_api_keys`
3. è®¾ç½®æ‚¨çš„ AI API `base_url` å’Œå‡­æ®
4. è®¾ç½®é€‚å½“çš„ `rust_log` çº§åˆ«ï¼ˆä¾‹å¦‚ï¼Œ`"info"`ï¼‰
5. è€ƒè™‘ä¸ºç”Ÿäº§éƒ¨ç½²è®¾ç½®åå‘ä»£ç†
6. ç¡®ä¿æ‚¨çš„ AI API æ”¯æŒæ‰€éœ€çš„ç«¯ç‚¹

## æ ¸å¿ƒä¾èµ–

```toml
# æ ¸å¿ƒæ¡†æ¶
rig-core = "0.18.2"          # æœ€æ–°çš„ AI ä»£ç†æ¡†æ¶

# å¼‚æ­¥è¿è¡Œæ—¶
tokio = "1.34.0"             # å…·æœ‰å®Œæ•´åŠŸèƒ½çš„å¼‚æ­¥è¿è¡Œæ—¶

# WebSocket
tokio-tungstenite = "0.27"   # çº¯ WebSocket å®ç°
futures-util = "0.3"         # å¼‚æ­¥æµå¤„ç†

# åºåˆ—åŒ–å’Œé”™è¯¯å¤„ç†
serde = "1.0"                # åºåˆ—åŒ–æ¡†æ¶
serde_json = "1.0"           # JSON æ”¯æŒ
anyhow = "1.0.75"            # é”™è¯¯å¤„ç†
thiserror = "2.0"            # é”™è¯¯æ´¾ç”Ÿå®

# é…ç½®ç®¡ç†
config = "0.15.14"           # ç»“æ„åŒ–é…ç½®æ–‡ä»¶æ”¯æŒ

# å‘é‡å­˜å‚¨å’Œé•¿æœŸè®°å¿†
rig-qdrant = "0.1.23"       # Qdrant å‘é‡å­˜å‚¨é›†æˆ
qdrant-client = "1.15.0"    # Qdrant å®¢æˆ·ç«¯

# åŠ å¯†å’Œå®ç”¨ç¨‹åº
hmac = "0.12"                # HMAC èº«ä»½éªŒè¯
sha2 = "0.10"                # SHA256 å“ˆå¸Œ
base64 = "0.22"              # Base64 ç¼–ç 
uuid = "1.0"                 # UUID ç”Ÿæˆ
chrono = "0.4"               # æ—¥æœŸå’Œæ—¶é—´å¤„ç†
```

**æ¶æ„ä¼˜åŒ–**ï¼š
- **ç§»é™¤çš„ä¾èµ–**ï¼šaxumã€towerã€tower-http ç­‰ HTTP æ¡†æ¶ä¾èµ–
- **ä¿ç•™çš„ä¾èµ–**ï¼štokio-tungstenite ç”¨äºçº¯ WebSocket é€šä¿¡
- **æ›´å°çš„äºŒè¿›åˆ¶æ–‡ä»¶**ï¼šå‡å°‘äº†çº¦ 30% çš„ç¼–è¯‘ä½“ç§¯
- **æ›´å¿«çš„å¯åŠ¨æ—¶é—´**ï¼šç§»é™¤ HTTP ä¸­é—´ä»¶å’Œè·¯ç”±å¼€é”€

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **èº«ä»½éªŒè¯å¤±è´¥**ï¼šæ£€æŸ¥ç­¾åç”Ÿæˆå’Œæ—¶é—´æˆ³éªŒè¯
2. **AI API è¿æ¥é—®é¢˜**ï¼šéªŒè¯ config.json ä¸­çš„ base_url å’Œ api_key é…ç½®
3. **WebSocket è¿æ¥é—®é¢˜**ï¼šæ£€æŸ¥é˜²ç«å¢™å’Œç½‘ç»œè®¾ç½®
4. **æ„å»ºé”™è¯¯**ï¼šç¡®ä¿ Rust ç‰ˆæœ¬ 1.70+ å¹¶è¿è¡Œ `cargo clean`
5. **é…ç½®æ–‡ä»¶é”™è¯¯**ï¼šæ£€æŸ¥ config.json æ ¼å¼å’Œå¿…éœ€å­—æ®µ
6. **Qdrant è¿æ¥å¤±è´¥**ï¼š
   - ç¡®ä¿ Qdrant æœåŠ¡å™¨æ­£åœ¨è¿è¡Œï¼ˆä¸‹è½½å¹¶å¯åŠ¨ Qdrant äºŒè¿›åˆ¶æ–‡ä»¶ï¼‰
   - æ£€æŸ¥ config.json ä¸­çš„ Qdrant URL é…ç½®
   - éªŒè¯ Qdrant ç‰ˆæœ¬å…¼å®¹æ€§
7. **é•¿æœŸè®°å¿†åŠŸèƒ½ä¸å·¥ä½œ**ï¼š
   - æ£€æŸ¥ `long_term_memory.enabled` æ˜¯å¦è®¾ç½®ä¸º `true`
   - éªŒè¯å‘é‡ç»´åº¦ä¸åµŒå…¥æ¨¡å‹åŒ¹é…ï¼ˆé»˜è®¤ 1536 for text-embedding-3-smallï¼‰
   - ç¡®è®¤ç›¸ä¼¼æ€§é˜ˆå€¼è®¾ç½®åˆç†ï¼ˆ0.0-1.0ï¼‰

### æ—¥å¿—è®°å½•

é€šè¿‡ config.json è®¾ç½®æ—¥å¿—çº§åˆ«ï¼š
```json
{
  "logging": {
    "rust_log": "debug"
  }
}
```

æˆ–ä¸´æ—¶è®¾ç½®ç¯å¢ƒå˜é‡ï¼š
```bash
$env:RUST_LOG="debug"; cargo run           # PowerShell
RUST_LOG=debug cargo run                   # Bash/Zsh
RUST_LOG=VtuberAPI=debug cargo run        # æ¨¡å—ç‰¹å®šæ—¥å¿—
```

## è®¸å¯è¯

MIT è®¸å¯è¯ - è¯¦è§ LICENSE æ–‡ä»¶ã€‚

## æ›´æ–°æ—¥å¿—

### ç‰ˆæœ¬ 0.2.0 (2025-08-21)
- **æ¶æ„é‡æ„**ï¼šç§»é™¤ axumã€tower ç­‰ HTTP æ¡†æ¶ä¾èµ–ï¼Œä½¿ç”¨çº¯ tokio-tungstenite å®ç°
- **WebSocket ä¼˜åŒ–**ï¼šç›´æ¥åœ¨æ ¹è·¯å¾„æä¾› WebSocket æœåŠ¡ï¼ˆ`ws://localhost:8000`ï¼‰
- **ä¾èµ–ç²¾ç®€**ï¼šå‡å°‘çº¦ 30% çš„ç¼–è¯‘ä½“ç§¯å’Œä¾èµ–å¤æ‚åº¦
- **æ€§èƒ½æå‡**ï¼šç§»é™¤ HTTP ä¸­é—´ä»¶å¼€é”€ï¼Œæå‡ WebSocket è¿æ¥æ€§èƒ½
- **Rig æ¡†æ¶å‡çº§**ï¼šä½¿ç”¨ Rig 0.18.2 çš„æœ€æ–°åŠŸèƒ½
- **æµ‹è¯•é¡µé¢æ›´æ–°**

### ç‰ˆæœ¬ 0.1.0 (2025-08-20)
- **Rig æ¡†æ¶å‡çº§**ï¼šä½¿ç”¨ Rig 0.18.1 çš„æœ€æ–°åŠŸèƒ½
- **Rust 2024 Edition**ï¼šä½¿ç”¨æœ€æ–°çš„ Rust 2024 edition
- **JSON é…ç½®ç®¡ç†**ï¼šæ”¯æŒåµŒå¥—é…ç½®å’Œå¤æ‚æ•°æ®ç±»å‹
- **é•¿æœŸè®°å¿†åŠŸèƒ½**ï¼šåŸºäº Qdrant å‘é‡æ•°æ®åº“çš„æ™ºèƒ½è®°å¿†ç³»ç»Ÿ
- **æ”¹è¿›çš„é”™è¯¯å¤„ç†**ï¼šæ›´å¥½çš„é…ç½®éªŒè¯å’Œé”™è¯¯æŠ¥å‘Š
- **çµæ´»çš„æ—¥å¿—é…ç½®**ï¼šé€šè¿‡é…ç½®æ–‡ä»¶ç®¡ç†æ—¥å¿—çº§åˆ«å’Œé€‰é¡¹
- **WebSocket é€šä¿¡**ï¼šå®æ—¶åŒå‘é€šä¿¡æ”¯æŒ
- **å¤šæ¨¡æ€å“åº”**ï¼šæ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘çš„å®Œæ•´æ”¯æŒ
- **HMAC-SHA256 èº«ä»½éªŒè¯**ï¼šå¸¦æ—¶é—´æˆ³éªŒè¯çš„å®‰å…¨è®¤è¯
- **å‘é‡å­˜å‚¨æ”¯æŒ**ï¼šå®Œæ•´çš„ Qdrant é›†æˆç”¨äºè¯­ä¹‰æœç´¢
